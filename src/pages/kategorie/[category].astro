---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar.astro';
import SearchModal from '../../components/SearchModal.astro';
import Footer from '../../components/Footer.astro';
import SEO from '../../components/SEO.astro';
import RecipeCard from '../../components/RecipeCard.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import RecipeGrid from '../../components/RecipeGrid.astro';
import { getAllRecipes, extractCategories, filterRecipesByCategory, slugifyCategory, getCategoryBySlug } from '../../utils/recipeHelpers';
import { pluralize } from '../../utils/pluralize';

export async function getStaticPaths() {
  const allRecipes = await getAllRecipes();
  const categories = extractCategories(allRecipes);

  return categories.map(category => ({
    params: { category: slugifyCategory(category) },
    props: {
      recipes: filterRecipesByCategory(allRecipes, slugifyCategory(category)),
      categoryName: category,
    },
  }));
}

const { category } = Astro.params;
const { recipes, categoryName } = Astro.props;
const capitalizedCategory = categoryName ? categoryName.charAt(0).toUpperCase() + categoryName.slice(1) : '';

const description = `Przeglądaj ${recipes.length} ${pluralize(recipes.length, 'recipe')} w kategorii ${categoryName}. Znajdź inspiracje na pyszne posiłki.`;
const keywords = [categoryName, 'przepisy', 'kuchnia', 'gotowanie', ...recipes.slice(0, 5).map(r => r.data.title)];
---

<BaseLayout title={`${capitalizedCategory} - Przepisy`}>
  <SEO
    slot="seo"
    title={`${capitalizedCategory} - Przepisy`}
    description={description}
    keywords={keywords}
    type="website"
  />
  <Navbar />
  <SearchModal />
  <main class="flex-1 container mx-auto px-4 py-8 max-w-7xl">
  <Breadcrumbs items={[
    { label: 'Strona główna', href: '/' },
    { label: 'Kategorie', href: '/kategorie' },
    { label: capitalizedCategory }
  ]} />

  <div class="mb-10">
    <h1 class="text-5xl font-bold mb-2 capitalize text-secondary">{categoryName}</h1>
    <p class="text-lg text-base-content/60">
      {recipes.length} {pluralize(recipes.length, 'recipe')} w tej kategorii
    </p>
  </div>

  <div class="divider"></div>

  <RecipeGrid>
    {recipes.map((recipe) => (
      <RecipeCard recipe={recipe} />
    ))}
  </RecipeGrid>
  </main>
  <Footer />
</BaseLayout>
